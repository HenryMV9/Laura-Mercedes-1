<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Shop luxury hair and beauty products. Premium wigs, extensions, and beauty accessories.">
  <title>Shop - Luxury Hair & Beauty Atelier</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/styles/global.css">
  <link rel="stylesheet" href="/styles/navigation.css">
  <link rel="stylesheet" href="/styles/shop.css">
  <link rel="stylesheet" href="/styles/footer.css">
</head>
<body>
  <nav class="navbar">
    <div class="navbar-content">
      <a href="/" class="nav-logo">LAURA MERCEDES</a>

      <ul class="nav-menu">
        <li><a href="/" class="nav-link">Home</a></li>
        <li><a href="/shop.html" class="nav-link">Shop</a></li>
        <li><a href="/services.html" class="nav-link">Services</a></li>
        <li><a href="/about.html" class="nav-link">About</a></li>
        <li><a href="/contact.html" class="nav-link">Contact</a></li>
      </ul>

      <div class="nav-icons">
        <div class="nav-icon" id="searchIcon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </div>
        <a href="/cart.html" class="nav-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 2L7 8h10l-2-6H9z"></path>
            <path d="M7 8v11a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V8"></path>
          </svg>
          <span class="cart-badge" style="display: none;">0</span>
        </a>
        <div class="mobile-menu-toggle">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
  </nav>

  <section class="shop-hero">
    <div class="container">
      <h1 class="shop-exclusive-title">Shop Our Collection</h1>
      <p>Discover premium quality hair and beauty products</p>
    </div>
  </section>

  <section class="shop-exclusive-header">
    <div class="container">
      <h2 class="shop-exclusive-title">Shop Our Exclusive Wigs</h2>
    </div>
  </section>

  <div class="container">
    <button class="btn btn-primary mobile-filter-toggle" id="mobileFilterToggle">
      Filter & Sort
    </button>

    <div class="shop-content">
      <aside class="shop-filters" id="shopFilters">
        <button class="btn btn-secondary filter-close" id="filterClose" style="display: none;">
          Close Filters
        </button>

        <div class="filter-section">
          <h3>Categories</h3>
          <div class="filter-group" id="categoryFilters">
            <div class="loading"></div>
          </div>
        </div>

        <div class="filter-section">
          <h3>Price Range (NGN)</h3>
          <div class="filter-group">
            <div class="price-inputs">
              <input type="number" class="price-input" id="minPrice" placeholder="Min">
              <input type="number" class="price-input" id="maxPrice" placeholder="Max">
            </div>
          </div>
        </div>

        <div class="filter-section">
          <h3>Availability</h3>
          <div class="filter-group">
            <label class="filter-option">
              <input type="checkbox" id="inStockFilter">
              <span>In Stock Only</span>
            </label>
          </div>
        </div>

        <div class="filter-actions">
          <button class="filter-btn" id="applyFilters">Apply</button>
          <button class="filter-btn filter-btn-clear" id="clearFilters">Clear</button>
        </div>
      </aside>

      <main class="shop-products">
        <div class="shop-controls">
          <div class="results-count" id="resultsCount">
            Loading products...
          </div>
          <select class="sort-select" id="sortSelect">
            <option value="newest">Newest First</option>
            <option value="price-low">Price: Low to High</option>
            <option value="price-high">Price: High to Low</option>
            <option value="name">Name: A to Z</option>
          </select>
        </div>

        <div class="products-grid" id="productsGrid">
          <div class="loading" style="margin: 0 auto;"></div>
        </div>
      </main>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>About Us</h3>
          <p>
            Nigeria's premier destination for luxury hair and beauty products. We bring international
            quality and style to Abuja.
          </p>
        </div>

        <div class="footer-section">
          <h3>Quick Links</h3>
          <ul class="footer-links">
            <li><a href="/shop.html">Shop</a></li>
            <li><a href="/services.html">Services</a></li>
            <li><a href="/about.html">About Us</a></li>
            <li><a href="/faq.html">FAQ</a></li>
            <li><a href="/policies.html">Policies</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h3>Contact Us</h3>
          <div class="footer-contact-info">
            <div class="footer-contact-item">
              <span>üìç</span>
              <span>No 27 Alexandria Crescent, Wuse 2, Abuja</span>
            </div>
            <div class="footer-contact-item">
              <span>üìû</span>
              <span>+234 814 337 2835</span>
            </div>
            <div class="footer-contact-item">
              <span>‚úâÔ∏è</span>
              <span>hello@luxuryatelier.ng</span>
            </div>
          </div>
        </div>

        <div class="footer-section">
          <h3>Follow Us</h3>
          <div class="footer-social">
            <a href="#" class="footer-social-link" aria-label="Instagram">IG</a>
            <a href="#" class="footer-social-link" aria-label="Facebook">FB</a>
            <a href="#" class="footer-social-link" aria-label="Twitter">TW</a>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2025 Luxury Atelier. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <a href="https://wa.me/2348143372835" class="whatsapp-float" target="_blank" rel="noopener" aria-label="Chat on WhatsApp">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
      <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
    </svg>
  </a>

  <script type="module" src="/js/navigation.js"></script>
  <script type="module" src="/js/cart.js"></script>
  <script type="module">
    import { getCategories, getProducts } from '/js/supabase-client.js';
    import { formatCurrency, addToCart } from '/js/cart.js';

    let allProducts = [];
    let filteredProducts = [];
    let currentFilters = {
      categoryId: null,
      minPrice: null,
      maxPrice: null,
      inStock: false
    };

    const urlParams = new URLSearchParams(window.location.search);
    const categorySlug = urlParams.get('category');

    async function loadCategories() {
      const categories = await getCategories();
      const container = document.getElementById('categoryFilters');

      container.innerHTML = `
        <label class="filter-option">
          <input type="radio" name="category" value="" checked>
          <span>All Products</span>
        </label>
        ${categories.map(cat => `
          <label class="filter-option">
            <input type="radio" name="category" value="${cat.id}">
            <span>${cat.name}</span>
          </label>
        `).join('')}
      `;

      if (categorySlug) {
        const category = categories.find(c => c.slug === categorySlug);
        if (category) {
          currentFilters.categoryId = category.id;
          const radio = container.querySelector(`input[value="${category.id}"]`);
          if (radio) radio.checked = true;
        }
      }
    }

    async function loadProducts() {
      allProducts = await getProducts();
      applyFilters();
    }

    function applyFilters() {
      filteredProducts = allProducts.filter(product => {
        if (currentFilters.categoryId && product.category_id !== currentFilters.categoryId) {
          return false;
        }

        if (currentFilters.minPrice && product.price < currentFilters.minPrice) {
          return false;
        }

        if (currentFilters.maxPrice && product.price > currentFilters.maxPrice) {
          return false;
        }

        if (currentFilters.inStock && !product.in_stock) {
          return false;
        }

        return true;
      });

      renderProducts();
    }

    function renderProducts() {
      const grid = document.getElementById('productsGrid');
      const resultsCount = document.getElementById('resultsCount');

      resultsCount.textContent = `${filteredProducts.length} ${filteredProducts.length === 1 ? 'product' : 'products'}`;

      if (filteredProducts.length === 0) {
        grid.innerHTML = `
          <div class="no-products">
            <p>No products found matching your filters.</p>
            <button class="btn btn-primary" id="resetFilters">Clear All Filters</button>
          </div>
        `;
        document.getElementById('resetFilters')?.addEventListener('click', clearFilters);
        return;
      }

      grid.innerHTML = filteredProducts.map(product => {
        const hasDiscount = product.compare_at_price && product.compare_at_price > product.price;

        return `
          <div class="product-card">
            <div class="product-image-wrapper">
              <a href="/product.html?slug=${product.slug}">
                <img src="${product.main_image}" alt="${product.name}" class="product-image">
              </a>
              ${product.featured ? '<span class="product-badge">Featured</span>' : ''}
              ${!product.in_stock ? '<span class="product-badge" style="background: var(--color-gray-600);">Sold Out</span>' : ''}
              ${product.in_stock ? `<button class="product-quick-add" data-id="${product.id}">Add to Cart</button>` : ''}
            </div>
            <div class="product-info">
              <p class="product-category">${product.categories?.name || 'Uncategorized'}</p>
              <h3 class="product-name">
                <a href="/product.html?slug=${product.slug}">${product.name}</a>
              </h3>
              <div class="product-price">
                <span class="current-price">${formatCurrency(product.price)}</span>
                ${hasDiscount ? `<span class="original-price">${formatCurrency(product.compare_at_price)}</span>` : ''}
              </div>
            </div>
          </div>
        `;
      }).join('');

      document.querySelectorAll('.product-quick-add').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const productId = btn.dataset.id;
          const product = allProducts.find(p => p.id === productId);
          if (product) {
            addToCart(product);
            btn.textContent = 'Added!';
            setTimeout(() => {
              btn.textContent = 'Add to Cart';
            }, 2000);
          }
        });
      });
    }

    function clearFilters() {
      currentFilters = {
        categoryId: null,
        minPrice: null,
        maxPrice: null,
        inStock: false
      };

      document.querySelector('input[name="category"][value=""]').checked = true;
      document.getElementById('minPrice').value = '';
      document.getElementById('maxPrice').value = '';
      document.getElementById('inStockFilter').checked = false;

      applyFilters();
    }

    document.getElementById('applyFilters').addEventListener('click', () => {
      const selectedCategory = document.querySelector('input[name="category"]:checked')?.value;
      currentFilters.categoryId = selectedCategory || null;
      currentFilters.minPrice = parseFloat(document.getElementById('minPrice').value) || null;
      currentFilters.maxPrice = parseFloat(document.getElementById('maxPrice').value) || null;
      currentFilters.inStock = document.getElementById('inStockFilter').checked;

      applyFilters();

      if (window.innerWidth <= 1024) {
        document.getElementById('shopFilters').classList.remove('active');
      }
    });

    document.getElementById('clearFilters').addEventListener('click', clearFilters);

    document.getElementById('sortSelect').addEventListener('change', (e) => {
      const sortValue = e.target.value;

      switch (sortValue) {
        case 'price-low':
          filteredProducts.sort((a, b) => a.price - b.price);
          break;
        case 'price-high':
          filteredProducts.sort((a, b) => b.price - a.price);
          break;
        case 'name':
          filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
          break;
        default:
          filteredProducts.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      }

      renderProducts();
    });

    document.getElementById('mobileFilterToggle').addEventListener('click', () => {
      document.getElementById('shopFilters').classList.add('active');
      document.getElementById('filterClose').style.display = 'block';
    });

    document.getElementById('filterClose').addEventListener('click', () => {
      document.getElementById('shopFilters').classList.remove('active');
    });

    await loadCategories();
    await loadProducts();
  </script>
</body>
</html>
